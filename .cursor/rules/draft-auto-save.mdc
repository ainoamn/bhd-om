---
description: حفظ تلقائي كمسودة - سلوك عام للموقع
globs: "**/*.tsx,**/*.ts"
alwaysApply: true
---

# حفظ المسودات تلقائياً (Draft Auto-Save)

## المعيار الثابت

كل ما يُدخل في الموقع، في جميع الصفحات وبدون استثناء:
1. يُحفظ تلقائياً كمسودة (لا تُحذف البيانات)
2. تُطبق البيانات المدخلة فقط بعد النقر على زر "حفظ"
3. تنبيه للمستخدم: "البيانات المدخلة لن تظهر في النظام إلا بعد الحفظ"

## الأدوات

```ts
// lib/utils/draftStorage.ts
saveDraft(key, data)   // حفظ مسودة
loadDraft<T>(key)      // تحميل مسودة
clearDraft(key)        // حذف مسودة عند الحفظ
hasDrafts()            // هل توجد مسودات؟
```

## النمط

1. **مفتاح المسودة**: فريد لكل نموذج، مثلاً `property_${id}`, `extra-data_${id}`, `contact_new`
2. **عند التحميل**: `loadDraft(key)` — إن وُجدت مسودة، استخدمها (أو ادمجها مع البيانات الأصلية)
3. **عند التغيير**: `saveDraft(key, formState)` — مع debounce (~800ms)
4. **عند الحفظ**: `clearDraft(key)` — بعد الالتزام بنجاح
5. **بانر تنبيه**: `DraftBanner` يظهر تلقائياً عند وجود مسودات
