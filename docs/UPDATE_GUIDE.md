# دليل التحديث الآمن

## قبل أي تحديث: نسخ احتياطي كامل

### 1. تصدير بيانات المتصفح (localStorage)

1. افتح التطبيق في المتصفح
2. اذهب إلى **لوحة الإدارة** → **النسخ الاحتياطي** (`/admin/backup`)
3. اضغط **"تصدير نسخة احتياطية"**
4. احفظ الملف `bhd-backup-YYYY-MM-DD.json` في مكان آمن (سحابة، قرص خارجي، مجلد مشترك)

> يحتوي التصدير على: الحجوزات، العقود، دفتر العناوين، المحاسبة، العقارات، الفواتير، البيانات المالية، إلخ.

### 2. نسخ قاعدة البيانات

قاعدة البيانات (المستخدمون، الجلسات، إلخ) موجودة في:

- `prisma/dev.db`

**نسخ يدوي:**
- انسخ الملف `prisma/dev.db` إلى مجلد آمن

**أو استخدم السكريبت:**
```powershell
.\scripts\backup-all.ps1
```
ينشئ مجلد `backups/YYYY-MM-DD_HH-mm/` ونسخة من `dev.db` فيه.

### 3. حفظ الملفات في مكان آمن

- Google Drive / OneDrive / أي سحابة
- قرص خارجي
- أو مجلد مشترك للفريق

---

## أثناء التحديث

1. **أوقف السيرفر** إن كان يعمل
2. **ارفع التعديلات** (git pull أو دمج التفرعات)
3. **تثبيت الحزم** إن لزم: `npm install`
4. **ترحيل قاعدة البيانات** إن وجدت تغييرات في الـ schema:
   ```bash
   npx prisma migrate deploy
   # أو للبيئة التطويرية:
   npx prisma db push
   ```
5. **إعادة التشغيل**: `npm run dev` أو تشغيل الإنتاج

---

## في حال فقدان البيانات

### استعادة localStorage

1. اذهب إلى `/admin/backup`
2. اضغط **"استيراد نسخة احتياطية"**
3. اختر ملف `bhd-backup-*.json` الذي صدّرته سابقاً
4. اضغط **"استيراد"**

### استعادة قاعدة البيانات

1. أوقف التطبيق
2. استبدل `prisma/dev.db` بنسختك الاحتياطية
3. أعد التشغيل

---

## ملخص سريع

| الخطوة | الإجراء |
|--------|---------|
| 1 | تصدير من `/admin/backup` |
| 2 | نسخ `prisma/dev.db` أو تشغيل `.\scripts\backup-all.ps1` |
| 3 | حفظ الملفات في مكان آمن |
| 4 | تنفيذ التحديث (pull, install, migrate) |
| 5 | إعادة التشغيل |
